<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dgjs.mapper.content.AdminFeedBackMapper">
  
  	<insert id="save" parameterType="adminFeedBack" keyProperty="id" useGeneratedKeys="true">
	       insert into admin_feedback
	       (
	           message,
	           userId,
	           isHaveReply,
	           create_time
	       )
	       values
	       (
	           #{message},
	           #{userId},
	           #{isHaveReply},
	           now()
	       )
	</insert>
	
	<select id="listFeedBack" resultType="adminFeedBack">
	    select 
	           id,
	           message,
	           userId,
	           isHaveReply,
	           create_time
	    from admin_feedback 
        <include refid="conditionSql" />
      order by isHaveReply,create_time desc
	  limit #{beginNum},#{onePageSize}
	</select>
	
	<select id="countFeedBack" resultType="int">
	    select count(1)
	    from admin_feedback 
        <include refid="conditionSql" />
	</select>
	
	<sql id="conditionSql">
	  <where>
         <if test="isHaveReply!=null">and isHaveReply=#{isHaveReply}</if>
         <if test="timeFrom!=null"> <![CDATA[ and create_time >= #{timeFrom} ]]></if>
         <if test="timeTo!=null"> <![CDATA[ and create_time <= #{timeTo} ]]></if>
      </where>
	</sql>
	
	<select id="selectById" resultType="adminFeedBack">
	     select 
	           id,
	           message,
	           userId,
	           isHaveReply,
	           create_time
	    from admin_feedback where id = #{id}
	</select>
	
	<update id="updateToReply">
	     update admin_feedback set isHaveReply = 1 where id = #{id}
	</update>
</mapper>
