<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dgjs.mapper.admin.AdminUserMapper">
  
  <insert id="batchSave" useGeneratedKeys="true" parameterType="java.util.List">
   
    insert into admin_user 
          (
           username,
           status,
           source,
           role_id,
           user_code,
           headimgurl,
           create_time,
           update_time,
           unionid,
           openid
          )  
    values 
    <foreach collection="list" item="item" index="index" separator=",">
          (
           #{item.username},
           #{item.status},
           #{item.source},
           #{item.role_id},
           #{item.user_code},
           #{item.headimgurl},
           #{item.create_time},
           #{item.update_time},
           #{unionid},
           #{openid}
          ) 
    </foreach> 
  </insert>
  
  	<insert id="save" parameterType="adminUser" keyProperty="id" useGeneratedKeys="true">
	       insert into admin_user
	       (
               username,
               status,
               source,
               role_id,
               user_code,
               headimgurl,
               create_time,
               update_time,
               unionid,
               openid
	       )
	       values
	       (
               #{username},
               #{status},
               #{source},
               #{role_id},
               #{user_code},
               #{headimgurl},
               now(),
               now(),
               #{unionid},
               #{openid}
	       )
	</insert>
	
	<select id="selectById" resultType="adminUser">
	      select id,username,user_code,status,source,role_id,headimgurl,create_time,update_time,unionid,openid from admin_user where id=#{id}
	</select>
	
	<update id="update">
	      update admin_user
	         set 
	         <if test="status!=null and status!=''">
				status=#{status},
		     </if>
		     <if test="role_id!=null and role_id!=''">
				role_id=#{role_id},
		     </if>
		     update_time = now()
		     where id=#{id}
	</update>
	
	<select id="list" resultType="adminUserResult">
	   select au.id,au.username,au.user_code,au.status,au.source,au.role_id,au.headimgurl,au.unionid,au.openid
	   ,aui.real_name,aui.sex,aui.age,aui.organization,aui.email,aui.mobile,aui.address,au.create_time
	   ,aui.update_time,aui.province,aui.city,aui.country
	   from admin_user au
	   left join admin_user_info aui on au.id=aui.id where 1=1
	         <include refid="listsql"></include>
		order by aui.update_time desc
		limit #{beginNum},#{onePageSize}
	</select>
	
	<select id="count" resultType="int">
	   select count(1)
	   from admin_user au
	   left join admin_user_info aui on au.id=aui.id where 1=1
	         <include refid="listsql"></include>
	</select>
	
	<select id="getListIds" resultType="int">
	   select au.id
	   from admin_user au
	   left join admin_user_info aui on au.id=aui.id where 1=1
	         <include refid="listsql"></include>
	</select>
	
	<sql id="listsql">
	      <if test="username!=null and username!=''">
			and au.username=#{username}
		  </if>
	      <if test="status!=null and status!=''">
			and au.status=#{status}
		  </if>
		  <if test="role_id!=null and role_id!=''">
			and au.role_id=#{role_id}
		  </if>
		  <if test="real_name!=null and real_name!=''">
			and au.role_id=#{role_id}
		  </if>
		  <if test="email!=null and email!=''">
			and aui.email=#{email}
		  </if>
		  <if test="mobile!=null and mobile!=''">
			and aui.mobile=#{mobile}
		  </if>
		  <if test="adminIds!=null and adminIds.size()>0">
		        and au.id in
		        <foreach collection="adminIds" index="index" item="item" open="(" separator="," close=")">  
                 #{item}  
                </foreach>
          </if>
	</sql>
	
	<select id="getByUserCode" resultType="adminUser">
	  select id,username,user_code,status,source,role_id,headimgurl,create_time,update_time from admin_user where user_code=#{userCode}
	</select>
	
    <select id="getByUnionId">
      select id,username,user_code,status,source,role_id,headimgurl,create_time,update_time from admin_user where unionid=#{unionid}
    </select>
</mapper>
